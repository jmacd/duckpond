# Dynamic directory: synthetic sensors → join → pivot
#
# Layer 1: Four synthetic-timeseries (one per site×param sensor)
# Layer 2: Two timeseries-join (one per site, combining both params)
# Layer 3: Two timeseries-pivot (one per param, extracting across both sites)
#
# Data: 2025-01-01 through 2025-12-31, hourly resolution
# Sites: NorthDock, SouthDock
# Params: Temperature (°C), DO (mg/L)

entries:
  # ── Layer 1: Raw synthetic sensors ──────────────────────────────────────

  - name: "north_temperature"
    factory: "synthetic-timeseries"
    config:
      start: "2025-01-01T00:00:00Z"
      end:   "2025-12-31T23:00:00Z"
      interval: "1h"
      points:
        - name: "temperature.C"
          components:
            # Daily cycle: peaks afternoon, troughs pre-dawn
            - type: sine
              amplitude: 4.0
              period: "24h"
              offset: 14.0
            # Seasonal cycle: warm in summer, cool in winter
            - type: sine
              amplitude: 6.0
              period: "8760h"
              phase: -1.5708    # -π/2 so peak is mid-year (July)

  - name: "north_do"
    factory: "synthetic-timeseries"
    config:
      start: "2025-01-01T00:00:00Z"
      end:   "2025-12-31T23:00:00Z"
      interval: "1h"
      points:
        - name: "do.mgL"
          components:
            # DO inversely correlated with temperature
            - type: sine
              amplitude: 1.5
              period: "24h"
              offset: 8.0
              phase: 3.1416      # π — opposite phase from temperature
            # Seasonal: higher DO in winter (colder water holds more O2)
            - type: sine
              amplitude: 2.0
              period: "8760h"
              phase: 1.5708      # +π/2 so peak is mid-winter

  - name: "south_temperature"
    factory: "synthetic-timeseries"
    config:
      start: "2025-01-01T00:00:00Z"
      end:   "2025-12-31T23:00:00Z"
      interval: "1h"
      points:
        - name: "temperature.C"
          components:
            # Slightly warmer baseline, triangle waveform for variety
            - type: triangle
              amplitude: 3.5
              period: "24h"
              offset: 15.0
            # Seasonal
            - type: sine
              amplitude: 5.5
              period: "8760h"
              phase: -1.5708

  - name: "south_do"
    factory: "synthetic-timeseries"
    config:
      start: "2025-01-01T00:00:00Z"
      end:   "2025-12-31T23:00:00Z"
      interval: "1h"
      points:
        - name: "do.mgL"
          components:
            # Slightly lower baseline DO
            - type: sine
              amplitude: 1.2
              period: "24h"
              offset: 7.5
              phase: 3.1416
            # Seasonal with square-wave "bloom" component
            - type: square
              amplitude: 0.5
              period: "4380h"    # ~6 months
              offset: 0.0
            - type: sine
              amplitude: 1.8
              period: "8760h"
              phase: 1.5708

  # ── Layer 2: Per-site joins (combine both params at each site) ──────────

  - name: "NorthDock"
    factory: "timeseries-join"
    config:
      inputs:
        - pattern: "series:///sensors/north_temperature"
          scope: TempProbe
        - pattern: "series:///sensors/north_do"
          scope: DOProbe

  - name: "SouthDock"
    factory: "timeseries-join"
    config:
      inputs:
        - pattern: "series:///sensors/south_temperature"
          scope: TempProbe
        - pattern: "series:///sensors/south_do"
          scope: DOProbe

  # ── Layer 3: Per-param pivots (extract one param across both sites) ─────

  - name: "Temperature"
    factory: "timeseries-pivot"
    config:
      pattern: "series:///combined/*"
      columns:
        - "TempProbe.temperature.C"

  - name: "DO"
    factory: "timeseries-pivot"
    config:
      pattern: "series:///combined/*"
      columns:
        - "DOProbe.do.mgL"
