# Temporal-reduce configuration for Caspar Water metrics.
#
# Dynamic-dir containing five temporal-reduce factories, one per instrument:
#   - Well depth (Opto 22 / GRV-R7)
#   - Tank level (concrete storage tank)
#   - System pressure (main distribution pressure)
#   - Chlorine level (chlorine tank inventory)
#   - pH (Atlas Scientific pH probe)
#
# Each entry reads OtelJSON from /casparwater-sample.json on the host filesystem
# and produces a three-level tree:
#   <name>/data/res=1h.series
#   <name>/data/res=6h.series
#   <name>/data/res=1d.series
#
# The sitegen export pattern "/reduced/*/*/*.series" matches this structure.
#
# Usage (hostmount -- no pond required):
#   pond run -d ./water \
#     --hostmount /reduced=host+dyndir:///reduce.yaml \
#     host+sitegen:///site.yaml build ./dist
#
# Usage (pond):
#   pond mknod dynamic-dir /reduced --config-path reduce.yaml

entries:
  # -- Well Depth ---------------------------------------------------------------
  - name: "well-depth"
    factory: "temporal-reduce"
    config:
      in_pattern: "oteljson:///casparwater-sample.json"
      out_pattern: "data"
      time_column: "timestamp"
      resolutions: [1h, 6h, 1d]
      aggregations:
        - type: "avg"
          columns:
            - "well_depth_value"
        - type: "min"
          columns:
            - "well_depth_value"
        - type: "max"
          columns:
            - "well_depth_value"

  # -- Tank Level ---------------------------------------------------------------
  - name: "tank-level"
    factory: "temporal-reduce"
    config:
      in_pattern: "oteljson:///casparwater-sample.json"
      out_pattern: "data"
      time_column: "timestamp"
      resolutions: [1h, 6h, 1d]
      aggregations:
        - type: "avg"
          columns:
            - "concrete_tank_level_value"
        - type: "min"
          columns:
            - "concrete_tank_level_value"
        - type: "max"
          columns:
            - "concrete_tank_level_value"

  # -- System Pressure ----------------------------------------------------------
  - name: "system-pressure"
    factory: "temporal-reduce"
    config:
      in_pattern: "oteljson:///casparwater-sample.json"
      out_pattern: "data"
      time_column: "timestamp"
      resolutions: [1h, 6h, 1d]
      aggregations:
        - type: "avg"
          columns:
            - "system_pressure_value"
        - type: "min"
          columns:
            - "system_pressure_value"
        - type: "max"
          columns:
            - "system_pressure_value"

  # -- Chlorine Level -----------------------------------------------------------
  - name: "chlorine-level"
    factory: "temporal-reduce"
    config:
      in_pattern: "oteljson:///casparwater-sample.json"
      out_pattern: "data"
      time_column: "timestamp"
      resolutions: [1h, 6h, 1d]
      aggregations:
        - type: "avg"
          columns:
            - "chlorine_level_value"
        - type: "min"
          columns:
            - "chlorine_level_value"
        - type: "max"
          columns:
            - "chlorine_level_value"

  # -- pH -----------------------------------------------------------------------
  - name: "ph"
    factory: "temporal-reduce"
    config:
      in_pattern: "oteljson:///casparwater-sample.json"
      out_pattern: "data"
      time_column: "timestamp"
      resolutions: [1h, 6h, 1d]
      aggregations:
        - type: "avg"
          columns:
            - "atlasph_ph"
        - type: "min"
          columns:
            - "atlasph_ph"
        - type: "max"
          columns:
            - "atlasph_ph"
